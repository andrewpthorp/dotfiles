#!/usr/bin/env ruby

require 'espn'
require 'bitly'

Bitly.configure do |config|
  config.api_version = 3
  config.login = 'andrewpthorp'
  config.api_key = ENV['BITLY_API_KEY']
end

ESPN.configure do |config|
  config.api_key = ENV['ESPN_API_KEY']
end

begin
  espn = ESPN::Client.new
  bitly = Bitly.client

  headline = espn.headlines(:nfl, teams: 21).first
  link = bitly.shorten(headline.links.web.href)

  result = "Updated at #{Time.now.strftime('%l:%M:%S')}"

  if headline.type == 'Recap'
    result += " - #{headline.linkText}"
  else
    result += " - #{headline.title}"
  end

  result += " - #{link.short_url}"
  puts result

rescue Exception => e
  puts e.message
end
