#compdef pw

_pw_passwords() {
  passwords=(`pw ls`)
}

local -a _1st_arguments
_1st_arguments=(
  {a,add}':add a new password'
  {e,edit}':edit a password'
  {g,get}':retrieve a password'
  {l,ls}':list all passwords'
  {m,mv}':move (rename) a password'
  {r,rm}':remove a password'
)

local expl
local -a passwords

if (( CURRENT == 2 )); then
  _describe -t commands "pw subcommand" _1st_arguments
  return
fi

case "$words[2]" in
  g|get|r|rm|e|edit|m|mv)
    _pw_passwords
    _wanted passwords expl 'all passwords' compadd -a passwords ;;
esac
